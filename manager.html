<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DTM Events Manager</title>
  <style>
    body { background: #121212; color: #e0e0e0; font-family: sans-serif; max-width: 700px; margin: 2rem auto; padding: 1rem; }
    h1, h2 { color: #4ade80; text-align: center; }
    label { font-weight: 600; margin-top: 1rem; display: block; }
    input, select, button, textarea { width: 100%; padding: 0.6rem; margin-top: 0.5rem; border-radius: 8px; border: none; font-size: 1rem; box-sizing: border-box; }
    button { background: #4ade80; color: #121212; font-weight: 700; cursor: pointer; transition: background 0.2s; margin-top: 1rem; }
    button:hover:not(:disabled) { background: #22c55e; }
    .section { background: #1f1f1f; border-radius: 10px; padding: 1rem; margin-bottom: 2rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #333; padding: 0.5rem; text-align: left; }
    th { background-color: #333; }
    .small-btn { width: auto; padding: 0.3rem 0.6rem; font-size: 0.9rem; margin-left: 0.5rem; }
    .error { color: #f87171; font-weight: 700; }
    .success { color: #4ade80; font-weight: 700; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

<h1>DTM Events Manager</h1>

<div class="section">
  <h2>Events beheren</h2>
  <label>Nieuw event toevoegen</label>
  <input type="text" id="newEventName" placeholder="Naam event" />
  <input type="datetime-local" id="newEventDate" />
  <button id="addEventBtn">Event toevoegen</button>
  
  <h3>Bestaande events</h3>
  <table id="eventsTable">
    <thead><tr><th>Naam</th><th>Datum</th><th>Normaal tickets</th><th>VIP tickets</th><th>Acties</th></tr></thead>
    <tbody></tbody>
  </table>
</div>

<div class="section">
  <h2>VIP Codes beheren</h2>
  <label>Nieuwe VIP code toevoegen</label>
  <input type="text" id="newVipCode" placeholder="VIP code" />
  <input type="number" id="newVipLimit" placeholder="Max aantal keer te gebruiken" min="1" />
  <button id="addVipBtn">VIP code toevoegen</button>

  <h3>Bestaande VIP codes</h3>
  <table id="vipTable">
    <thead><tr><th>Code</th><th>Limit</th><th>Gebruikt</th><th>Acties</th></tr></thead>
    <tbody></tbody>
  </table>
</div>

<div id="message" role="alert" style="margin-top:1rem;"></div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAq2hnWZnhoMzVC_NZ3efND3xEkijRy23k",
    authDomain: "dtm-evemts.firebaseapp.com",
    databaseURL: "https://dtm-evemts-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "dtm-evemts",
    storageBucket: "dtm-evemts.firebasestorage.app",
    messagingSenderId: "673592896357",
    appId: "1:673592896357:web:4aa0d051ad738c12a80f8c",
    measurementId: "G-GFRH4KY8GF"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const messageEl = document.getElementById('message');

  // EVENTS MANAGEMENT

  const newEventName = document.getElementById('newEventName');
  const newEventDate = document.getElementById('newEventDate');
  const addEventBtn = document.getElementById('addEventBtn');
  const eventsTableBody = document.querySelector('#eventsTable tbody');

  function showMessage(text, isError = false) {
    messageEl.textContent = text;
    messageEl.className = isError ? 'error' : 'success';
    setTimeout(() => { messageEl.textContent = ''; messageEl.className = ''; }, 4000);
  }

  function loadEvents() {
    db.ref('events').on('value', snap => {
      const events = snap.val() || {};
      eventsTableBody.innerHTML = '';
      for (const key in events) {
        const ev = events[key];
        const dateFormatted = new Date(ev.date).toLocaleString('nl-NL');
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${ev.name}</td>
          <td>${dateFormatted}</td>
          <td>${ev.tickets.normal || 0}</td>
          <td>${ev.tickets.vip || 0}</td>
          <td>
            <button class="small-btn" onclick="resetTickets('${key}')">Reset tickets</button>
            <button class="small-btn" onclick="deleteEvent('${key}')">Verwijder</button>
          </td>
        `;
        eventsTableBody.appendChild(tr);
      }
    });
  }

  addEventBtn.onclick = () => {
    const name = newEventName.value.trim();
    const date = newEventDate.value;
    if (!name || !date) {
      showMessage('Vul naam en datum in.', true);
      return;
    }
    const eventKey = db.ref('events').push().key;
    db.ref(`events/${eventKey}`).set({
      name,
      date: new Date(date).toISOString(),
      tickets: { normal: 0, vip: 0 }
    }).then(() => {
      showMessage('Event toegevoegd.');
      newEventName.value = '';
      newEventDate.value = '';
    });
  };

  function resetTickets(key) {
    if (!confirm('Weet je zeker dat je alle tickets wilt resetten voor dit event?')) return;
    db.ref(`events/${key}/tickets`).set({ normal: 0, vip: 0 }).then(() => {
      showMessage('Tickets gereset.');
    });
  }

  function deleteEvent(key) {
    if (!confirm('Weet je zeker dat je dit event wilt verwijderen?')) return;
    db.ref(`events/${key}`).remove().then(() => {
      showMessage('Event verwijderd.');
    });
  }

  // VIP CODES MANAGEMENT

  const newVipCode = document.getElementById('newVipCode');
  const newVipLimit = document.getElementById('newVipLimit');
  const addVipBtn = document.getElementById('addVipBtn');
  const vipTableBody = document.querySelector('#vipTable tbody');

  function loadVipCodes() {
    db.ref('vipPasswords').on('value', snap => {
      const codes = snap.val() || {};
      vipTableBody.innerHTML = '';
      for (const code in codes) {
        const c = codes[code];
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${code}</td>
          <td>${c.limit || 0}</td>
          <td>${c.used || 0}</td>
          <td>
            <button class="small-btn" onclick="resetVipCode('${code}')">Reset gebruikt</button>
            <button class="small-btn" onclick="deleteVipCode('${code}')">Verwijder</button>
          </td>
        `;
        vipTableBody.appendChild(tr);
      }
    });
  }

  addVipBtn.onclick = () => {
    const code = newVipCode.value.trim();
    const limit = parseInt(newVipLimit.value, 10);
    if (!code || !limit || limit < 1) {
      showMessage('Vul een geldige code en limiet in.', true);
      return;
    }
    db.ref(`vipPasswords/${code}`).set({ limit, used: 0 }).then(() => {
      showMessage('VIP code toegevoegd.');
      newVipCode.value = '';
      newVipLimit.value = '';
    });
  };

  function resetVipCode(code) {
    if (!confirm(`Weet je zeker dat je de gebruikte telling wilt resetten voor VIP code ${code}?`)) return;
    db.ref(`vipPasswords/${code}/used`).set(0).then(() => {
      showMessage('VIP code gebruik gereset.');
    });
  }

  function deleteVipCode(code) {
    if (!confirm(`Weet je zeker dat je VIP code ${code} wilt verwijderen?`)) return;
    db.ref(`vipPasswords/${code}`).remove().then(() => {
      showMessage('VIP code verwijderd.');
    });
  }

  // Maak functies globaal, zodat ze bereikbaar zijn in onclick html attribuut
  window.resetTickets = resetTickets;
  window.deleteEvent = deleteEvent;
  window.resetVipCode = resetVipCode;
  window.deleteVipCode = deleteVipCode;

  loadEvents();
  loadVipCodes();
</script>

</body>
</html>
