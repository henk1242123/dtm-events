<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DTM Events Manager</title>
  <style>
    body { background: #121212; color: #e0e0e0; font-family: sans-serif; max-width: 600px; margin: 3rem auto; padding: 1rem; }
    h1 { text-align: center; color: #4ade80; margin-bottom: 1rem; }
    .section { background: #1f1f1f; border-radius: 10px; padding: 1rem; margin-bottom: 1.5rem; }
    label { font-weight: 600; display: block; margin-top: 1rem; }
    input, select, button { width: 100%; padding: 0.6rem; margin-top: 0.5rem; border-radius: 8px; border: none; font-size: 1rem; box-sizing: border-box; }
    button { background: #4ade80; color: #121212; font-weight: 700; cursor: pointer; transition: background 0.2s; }
    button:hover:not(:disabled) { background: #22c55e; }
    button:disabled { background: #555; cursor: not-allowed; }
    #message { margin-top: 1rem; font-weight: 700; min-height: 1.5em; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

<h1>DTM Events Manager</h1>

<div class="section" id="loginSection">
  <label>Wachtwoord</label>
  <input type="password" id="passwordInput" autocomplete="off" />
  <button id="loginBtn">Login</button>
  <div id="loginMessage" style="color:#fbbf24; margin-top:0.5rem;"></div>
</div>

<div class="section" id="managerSection" style="display:none;">
  <label>Kies een event</label>
  <select id="eventsSelect"></select>
  
  <label>Event naam</label>
  <input type="text" id="eventName" />

  <label>Datum en tijd</label>
  <input type="datetime-local" id="eventDate" />

  <label>Aantal normale tickets</label>
  <input type="number" id="normalTickets" min="0" />

  <label>Aantal VIP tickets</label>
  <input type="number" id="vipTickets" min="0" />

  <button id="saveEventBtn">Event opslaan</button>
  <button id="resetTicketsBtn">Tickets resetten naar 0</button>
  <button id="logoutBtn" style="margin-top:1rem; background:#ef4444;">Uitloggen</button>

  <div id="message" aria-live="polite"></div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAq2hnWZnhoMzVC_NZ3efND3xEkijRy23k",
    authDomain: "dtm-evemts.firebaseapp.com",
    databaseURL: "https://dtm-evemts-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "dtm-evemts",
    storageBucket: "dtm-evemts.firebasestorage.app",
    messagingSenderId: "673592896357",
    appId: "1:673592896357:web:4aa0d051ad738c12a80f8c",
    measurementId: "G-GFRH4KY8GF"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const passwordInput = document.getElementById('passwordInput');
  const loginBtn = document.getElementById('loginBtn');
  const loginMessage = document.getElementById('loginMessage');

  const managerSection = document.getElementById('managerSection');
  const eventsSelect = document.getElementById('eventsSelect');
  const eventName = document.getElementById('eventName');
  const eventDate = document.getElementById('eventDate');
  const normalTickets = document.getElementById('normalTickets');
  const vipTickets = document.getElementById('vipTickets');
  const saveEventBtn = document.getElementById('saveEventBtn');
  const resetTicketsBtn = document.getElementById('resetTicketsBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const message = document.getElementById('message');

  const ADMIN_PASSWORD = "dtmadmin3";

  let currentEventKey = null;

  loginBtn.addEventListener('click', () => {
    if (passwordInput.value === ADMIN_PASSWORD) {
      loginMessage.textContent = '';
      document.getElementById('loginSection').style.display = 'none';
      managerSection.style.display = 'block';
      loadEvents();
    } else {
      loginMessage.textContent = 'Ongeldig wachtwoord.';
    }
  });

  logoutBtn.addEventListener('click', () => {
    passwordInput.value = '';
    document.getElementById('loginSection').style.display = 'block';
    managerSection.style.display = 'none';
    clearForm();
    currentEventKey = null;
  });

  function loadEvents() {
    eventsSelect.innerHTML = '<option>Even laden...</option>';
    db.ref('events').once('value').then(snap => {
      const evs = snap.val() || {};
      eventsSelect.innerHTML = '';
      for (const key in evs) {
        const e = evs[key];
        const dateStr = new Date(e.date).toLocaleString('nl-NL');
        eventsSelect.innerHTML += `<option value="${key}">${e.name} (${dateStr})</option>`;
      }
      if (eventsSelect.options.length > 0) {
        eventsSelect.selectedIndex = 0;
        selectEvent(eventsSelect.value);
      } else {
        eventsSelect.innerHTML = '<option disabled>Geen events gevonden</option>';
        clearForm();
      }
    });
  }

  eventsSelect.addEventListener('change', () => {
    selectEvent(eventsSelect.value);
  });

  function selectEvent(key) {
    currentEventKey = key;
    message.textContent = '';
    if (!key) {
      clearForm();
      return;
    }
    db.ref('events/' + key).once('value').then(snap => {
      const e = snap.val();
      eventName.value = e.name || '';
      eventDate.value = e.date ? e.date.substring(0, 16) : '';
      normalTickets.value = e.tickets?.normal || 0;
      vipTickets.value = e.tickets?.vip || 0;
    });
  }

  saveEventBtn.addEventListener('click', () => {
    if (!currentEventKey) {
      message.textContent = 'Selecteer eerst een event.';
      return;
    }
    const name = eventName.value.trim();
    const date = eventDate.value;
    const normal = parseInt(normalTickets.value) || 0;
    const vip = parseInt(vipTickets.value) || 0;

    if (!name) {
      message.textContent = 'Voer een naam in.';
      return;
    }
    if (!date) {
      message.textContent = 'Voer een geldige datum en tijd in.';
      return;
    }

    const eventData = {
      name: name,
      date: new Date(date).toISOString(),
      tickets: {
        normal: normal,
        vip: vip
      }
    };

    db.ref('events/' + currentEventKey).set(eventData).then(() => {
      message.textContent = 'Event opgeslagen!';
      loadEvents();
      eventsSelect.value = currentEventKey;
    }).catch(err => {
      message.textContent = 'Fout bij opslaan: ' + err.message;
    });
  });

  resetTicketsBtn.addEventListener('click', () => {
    if (!currentEventKey) {
      message.textContent = 'Selecteer eerst een event om te resetten.';
      return;
    }
    db.ref(`events/${currentEventKey}/tickets`).set({normal: 0, vip: 0}).then(() => {
      message.textContent = 'Tickets gereset naar 0.';
      normalTickets.value = 0;
      vipTickets.value = 0;
    }).catch(err => {
      message.textContent = 'Fout bij resetten tickets: ' + err.message;
    });
  });

  function clearForm() {
    eventName.value = '';
    eventDate.value = '';
    normalTickets.value = 0;
    vipTickets.value = 0;
    message.textContent = '';
  }
</script>

</body>
</html>
