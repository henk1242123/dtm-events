<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DTM Events Manager</title>
  <style>
    body {
      background: #121212;
      color: #e0e0e0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 600px;
      margin: 3rem auto;
      padding: 1rem;
    }
    h1 {
      text-align: center;
      color: #4ade80;
      margin-bottom: 1.5rem;
    }
    .section {
      background: #1f1f1f;
      border-radius: 10px;
      padding: 1rem 1.2rem;
      margin-bottom: 1.5rem;
      box-sizing: border-box;
    }
    label {
      font-weight: 600;
      margin-top: 1rem;
      display: block;
    }
    select, input[type="text"], input[type="datetime-local"], input[type="number"], input[type="password"], button {
      width: 100%;
      padding: 0.6rem;
      margin-top: 0.5rem;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
      box-sizing: border-box;
      background: #2a2a2a;
      color: #e0e0e0;
      transition: background 0.2s;
    }
    select:hover, input:hover {
      background: #3b3b3b;
    }
    button {
      background: #4ade80;
      color: #121212;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.2s;
      margin-top: 1rem;
    }
    button:hover:not(:disabled) {
      background: #22c55e;
    }
    button:disabled {
      background: #555;
      cursor: not-allowed;
    }
    #logoutBtn {
      background: #ef4444;
      margin-top: 1rem;
    }
    #message {
      margin-top: 1rem;
      font-weight: 700;
      min-height: 1.5em;
      text-align: center;
      color: #86efac;
    }
    #loginMessage {
      color: #fbbf24;
      margin-top: 0.5rem;
      text-align: center;
      font-weight: 600;
    }
    .btn-inline {
      display: inline-block;
      width: auto;
      margin-top: 0;
      margin-left: 0.5rem;
      padding: 0.45rem 1rem;
      font-weight: 700;
    }
    .flex-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

<h1>DTM Events Manager</h1>

<div class="section" id="loginSection">
  <label for="passwordInput">Wachtwoord</label>
  <input type="password" id="passwordInput" autocomplete="off" />
  <button id="loginBtn">Inloggen</button>
  <div id="loginMessage"></div>
</div>

<div class="section" id="managerSection" style="display:none;">
  <div class="flex-row">
    <label for="eventsSelect" style="flex-grow:1;">Kies een event</label>
    <button id="newEventBtn" class="btn-inline">Nieuw event</button>
  </div>
  <select id="eventsSelect"></select>

  <label for="eventName">Event naam</label>
  <input type="text" id="eventName" placeholder="Bijv. Zomerfeest 2025" />

  <label for="eventDate">Datum en tijd</label>
  <input type="datetime-local" id="eventDate" />

  <label for="normalTickets">Aantal normale tickets</label>
  <input type="number" id="normalTickets" min="0" />

  <label for="vipTickets">Aantal VIP tickets</label>
  <input type="number" id="vipTickets" min="0" />

  <button id="saveEventBtn">Event opslaan</button>
  <button id="resetTicketsBtn">Tickets resetten naar 0</button>
  <button id="deleteEventBtn" style="background:#ef4444; margin-top: 0.5rem;">Event verwijderen</button>
  <button id="logoutBtn">Uitloggen</button>

  <div id="message" aria-live="polite"></div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAq2hnWZnhoMzVC_NZ3efND3xEkijRy23k",
    authDomain: "dtm-evemts.firebaseapp.com",
    databaseURL: "https://dtm-evemts-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "dtm-evemts",
    storageBucket: "dtm-evemts.firebasestorage.app",
    messagingSenderId: "673592896357",
    appId: "1:673592896357:web:4aa0d051ad738c12a80f8c",
    measurementId: "G-GFRH4KY8GF"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const ADMIN_PASSWORD = "dtmadmin3";

  const passwordInput = document.getElementById('passwordInput');
  const loginBtn = document.getElementById('loginBtn');
  const loginMessage = document.getElementById('loginMessage');

  const loginSection = document.getElementById('loginSection');
  const managerSection = document.getElementById('managerSection');

  const eventsSelect = document.getElementById('eventsSelect');
  const newEventBtn = document.getElementById('newEventBtn');

  const eventName = document.getElementById('eventName');
  const eventDate = document.getElementById('eventDate');
  const normalTickets = document.getElementById('normalTickets');
  const vipTickets = document.getElementById('vipTickets');

  const saveEventBtn = document.getElementById('saveEventBtn');
  const resetTicketsBtn = document.getElementById('resetTicketsBtn');
  const deleteEventBtn = document.getElementById('deleteEventBtn');
  const logoutBtn = document.getElementById('logoutBtn');

  const message = document.getElementById('message');

  let currentEventKey = null;

  loginBtn.addEventListener('click', () => {
    if (passwordInput.value === ADMIN_PASSWORD) {
      loginMessage.textContent = '';
      loginSection.style.display = 'none';
      managerSection.style.display = 'block';
      loadEvents();
    } else {
      loginMessage.textContent = 'Ongeldig wachtwoord.';
    }
  });

  logoutBtn.addEventListener('click', () => {
    passwordInput.value = '';
    loginSection.style.display = 'block';
    managerSection.style.display = 'none';
    clearForm();
    message.textContent = '';
    currentEventKey = null;
  });

  function loadEvents() {
    eventsSelect.innerHTML = '<option>Even laden...</option>';
    db.ref('events').once('value').then(snap => {
      const evs = snap.val() || {};
      eventsSelect.innerHTML = '';
      for (const key in evs) {
        const e = evs[key];
        const dateStr = new Date(e.date).toLocaleString('nl-NL', {year:'numeric', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit'});
        eventsSelect.innerHTML += `<option value="${key}">${e.name} (${dateStr})</option>`;
      }
      if (eventsSelect.options.length > 0) {
        eventsSelect.selectedIndex = 0;
        selectEvent(eventsSelect.value);
      } else {
        eventsSelect.innerHTML = '<option disabled>Geen events gevonden</option>';
        clearForm();
      }
    });
  }

  eventsSelect.addEventListener('change', () => {
    selectEvent(eventsSelect.value);
  });

  newEventBtn.addEventListener('click', () => {
    currentEventKey = null;
    clearForm();
    eventsSelect.selectedIndex = -1;
    message.textContent = 'Maak een nieuw event aan en klik op opslaan.';
  });

  function selectEvent(key) {
    if (!key) {
      clearForm();
      currentEventKey = null;
      message.textContent = '';
      return;
    }
    currentEventKey = key;
    message.textContent = '';
    db.ref('events/' + key).once('value').then(snap => {
      const e = snap.val();
      eventName.value = e.name || '';
      eventDate.value = e.date ? e.date.substring(0,16) : '';
      normalTickets.value = e.tickets?.normal || 0;
      vipTickets.value = e.tickets?.vip || 0;
    });
  }

  saveEventBtn.addEventListener('click', () => {
    const name = eventName.value.trim();
    const date = eventDate.value;
    const normal = parseInt(normalTickets.value) || 0;
    const vip = parseInt(vipTickets.value) || 0;

    if (!name) {
      message.textContent = 'Voer een naam in.';
      return;
    }
    if (!date) {
      message.textContent = 'Voer een geldige datum en tijd in.';
      return;
    }

    const eventData = {
      name: name,
      date: new Date(date).toISOString(),
      tickets: { normal, vip }
    };

    if (currentEventKey) {
      // update bestaand event
      db.ref('events/' + currentEventKey).set(eventData)
        .then(() => {
          message.textContent = 'Event bijgewerkt!';
          loadEvents();
          eventsSelect.value = currentEventKey;
        })
        .catch(e => message.textContent = 'Fout bij opslaan: ' + e.message);
    } else {
      // nieuw event aanmaken
      const newKey = db.ref('events').push().key;
      db.ref('events/' + newKey).set(eventData)
        .then(() => {
          message.textContent = 'Nieuw event aangemaakt!';
          loadEvents();
          currentEventKey = newKey;
          eventsSelect.value = newKey;
        })
        .catch(e => message.textContent = 'Fout bij aanmaken: ' + e.message);
    }
  });

  resetTicketsBtn.addEventListener('click', () => {
    if (!currentEventKey) {
      message.textContent = 'Selecteer eerst een event om te resetten.';
      return;
    }
    db.ref(`events/${currentEventKey}/tickets`).set({normal:0, vip:0})
      .then(() => {
        message.textContent = 'Tickets gereset naar 0.';
        normalTickets.value = 0;
        vipTickets.value = 0;
      })
      .catch(e => message.textContent = 'Fout bij resetten: ' + e.message);
  });

  deleteEventBtn.addEventListener('click', () => {
    if (!currentEventKey) {
      message.textContent = 'Selecteer eerst een event om te verwijderen.';
      return;
    }
    if (confirm('Weet je zeker dat je dit event wilt verwijderen? Dit kan niet ongedaan gemaakt worden.')) {
      db.ref('events/' + currentEventKey).remove()
        .then(() => {
          message.textContent = 'Event verwijderd.';
          currentEventKey = null;
          loadEvents();
          clearForm();
        })
        .catch(e => message.textContent = 'Fout bij verwijderen: ' + e.message);
    }
  });

  function clearForm() {
    eventName.value = '';
    eventDate.value = '';
    normalTickets.value = 0;
    vipTickets.value = 0;
  }
</script>

</body>
</html>
