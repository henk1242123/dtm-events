<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DTM Events Manager</title>
  <style>
    body { background: #121212; color: #e0e0e0; font-family: sans-serif; max-width: 700px; margin: 3rem auto; padding: 1rem; }
    h1 { text-align: center; color: #4ade80; margin-bottom: 1rem; }
    #loginSection, #managerSection { background: #1f1f1f; border-radius: 10px; padding: 1rem; margin-bottom: 1.5rem; }
    label { font-weight: 600; margin-top: 0.8rem; display: block; }
    input[type="text"], input[type="password"], input[type="datetime-local"], input[type="number"] {
      width: 100%; padding: 0.6rem; margin-top: 0.5rem; border-radius: 8px; border: none; font-size: 1rem; box-sizing: border-box;
      background: #2a2a2a; color: #e0e0e0;
    }
    button {
      background: #4ade80; color: #121212; font-weight: 700; cursor: pointer; padding: 0.6rem 1rem;
      border: none; border-radius: 8px; margin-top: 0.7rem; transition: background 0.2s;
    }
    button:hover:not(:disabled) { background: #22c55e; }
    button:disabled { background: #555; cursor: not-allowed; }
    table {
      width: 100%; border-collapse: collapse; margin-top: 1rem;
      table-layout: fixed;
      word-wrap: break-word;
    }
    th, td {
      padding: 0.5rem 0.7rem; border-bottom: 1px solid #333; text-align: left;
    }
    th { background: #222; }
    .small-btn {
      background: #3b82f6; color: white; font-weight: 600; font-size: 0.9rem;
      padding: 0.3rem 0.6rem; border-radius: 6px; margin-right: 0.3rem;
    }
    .small-btn:hover { background: #2563eb; }
    #message {
      margin-top: 1rem; font-weight: 700; min-height: 1.5em; text-align: center;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

<h1>DTM Events Manager</h1>

<div id="loginSection">
  <label for="passwordInput">Wachtwoord:</label>
  <input type="password" id="passwordInput" autocomplete="off" />
  <button id="loginBtn">Inloggen</button>
  <div id="loginMessage" style="color:#fbbf24; margin-top:0.5rem;"></div>
</div>

<div id="managerSection" style="display:none;">
  <h2>Nieuwe event toevoegen</h2>
  <label>Naam event:</label>
  <input type="text" id="newEventName" placeholder="Bijv. DTM Festival 2025" />
  <label>Datum en tijd:</label>
  <input type="datetime-local" id="newEventDate" />
  <button id="addEventBtn">Event toevoegen</button>

  <h2>Bestaande events</h2>
  <table id="eventsTable">
    <thead>
      <tr>
        <th>Naam</th>
        <th>Datum & Tijd</th>
        <th>Tickets Normaal</th>
        <th>Tickets VIP</th>
        <th>Acties</th>
      </tr>
    </thead>
    <tbody>
      <!-- Events komen hier -->
    </tbody>
  </table>

  <button id="logoutBtn" style="background:#ef4444; margin-top:1rem;">Uitloggen</button>
  <div id="message"></div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAq2hnWZnhoMzVC_NZ3efND3xEkijRy23k",
    authDomain: "dtm-evemts.firebaseapp.com",
    databaseURL: "https://dtm-evemts-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "dtm-evemts",
    storageBucket: "dtm-evemts.firebasestorage.app",
    messagingSenderId: "673592896357",
    appId: "1:673592896357:web:4aa0d051ad738c12a80f8c",
    measurementId: "G-GFRH4KY8GF"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Login
  const passwordInput = document.getElementById('passwordInput');
  const loginBtn = document.getElementById('loginBtn');
  const loginMessage = document.getElementById('loginMessage');

  // Manager elements
  const loginSection = document.getElementById('loginSection');
  const managerSection = document.getElementById('managerSection');
  const newEventName = document.getElementById('newEventName');
  const newEventDate = document.getElementById('newEventDate');
  const addEventBtn = document.getElementById('addEventBtn');
  const eventsTableBody = document.querySelector('#eventsTable tbody');
  const messageEl = document.getElementById('message');
  const logoutBtn = document.getElementById('logoutBtn');

  const CORRECT_PASSWORD = "jouwVeiligWachtwoord123"; // Pas dit aan naar jouw gewenste wachtwoord

  function showMessage(text, isError = false) {
    messageEl.style.color = isError ? '#f87171' : '#86efac';
    messageEl.textContent = text;
  }

  function showLoginMessage(text) {
    loginMessage.textContent = text;
  }

  loginBtn.onclick = () => {
    const pw = passwordInput.value;
    if(pw === dtmadmin3){
      loginSection.style.display = 'none';
      managerSection.style.display = 'block';
      loadEvents();
      showLoginMessage('');
      passwordInput.value = '';
      showMessage('');
    } else {
      showLoginMessage('Ongeldig wachtwoord');
    }
  };

  logoutBtn.onclick = () => {
    managerSection.style.display = 'none';
    loginSection.style.display = 'block';
    showMessage('');
    showLoginMessage('');
  };

  addEventBtn.onclick = () => {
    const name = newEventName.value.trim();
    const dateVal = newEventDate.value;

    if (!name || !dateVal) {
      showMessage('Vul naam en datum in.', true);
      return;
    }

    const newEventKey = db.ref('events').push().key;
    const newEventObj = {
      name,
      date: new Date(dateVal).toISOString(),
      tickets: { normal: 0, vip: 0 }
    };

    db.ref(`events/${newEventKey}`).set(newEventObj)
      .then(() => {
        showMessage('Event toegevoegd!');
        newEventName.value = '';
        newEventDate.value = '';
      })
      .catch(() => showMessage('Fout bij toevoegen event.', true));
  };

  function loadEvents() {
    db.ref('events').on('value', snap => {
      const events = snap.val() || {};
      eventsTableBody.innerHTML = '';
      for (const key in events) {
        const ev = events[key];
        const dateForInput = new Date(ev.date).toISOString().slice(0,16);

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input type="text" value="${ev.name}" id="name_${key}" style="width: 95%" /></td>
          <td><input type="datetime-local" value="${dateForInput}" id="date_${key}" /></td>
          <td><input type="number" min="0" value="${ev.tickets.normal || 0}" onchange="updateTickets('${key}', 'normal', this.value)" /></td>
          <td><input type="number" min="0" value="${ev.tickets.vip || 0}" onchange="updateTickets('${key}', 'vip', this.value)" /></td>
          <td>
            <button class="small-btn" onclick="saveEvent('${key}')">Opslaan</button>
            <button class="small-btn" onclick="resetTickets('${key}')">Reset tickets</button>
            <button class="small-btn" onclick="deleteEvent('${key}')">Verwijder</button>
          </td>
        `;
        eventsTableBody.appendChild(tr);
      }
    });
  }

  function saveEvent(key) {
    const newName = document.getElementById(`name_${key}`).value.trim();
    const newDateVal = document.getElementById(`date_${key}`).value;

    if (!newName || !newDateVal) {
      showMessage('Naam en datum mogen niet leeg zijn.', true);
      return;
    }

    const updateObj = {
      name: newName,
      date: new Date(newDateVal).toISOString()
    };

    db.ref(`events/${key}`).update(updateObj)
      .then(() => showMessage('Event aangepast.'))
      .catch(() => showMessage('Fout bij aanpassen event.', true));
  }

  function updateTickets(key, type, value) {
    value = parseInt(value);
    if (isNaN(value) || value < 0) {
      showMessage('Tickets moeten een positief getal zijn.', true);
      return;
    }
    const updateObj = {};
    updateObj[`tickets/${type}`] = value;
    db.ref(`events/${key}`).update(updateObj)
      .then(() => showMessage(`Aantal ${type} tickets aangepast.`))
      .catch(() => showMessage('Fout bij aanpassen tickets.', true));
  }

  function resetTickets(key) {
    db.ref(`events/${key}/tickets`).set({ normal: 0, vip: 0 })
      .then(() => showMessage('Tickets gereset naar 0.'))
      .catch(() => showMessage('Fout bij resetten tickets.', true));
  }

  function deleteEvent(key) {
    if (!confirm('Weet je zeker dat je dit event wilt verwijderen?')) return;
    db.ref(`events/${key}`).remove()
      .then(() => showMessage('Event verwijderd.'))
      .catch(() => showMessage('Fout bij verwijderen event.', true));
  }

  // Globale functies beschikbaar voor onclick in tabel
  window.saveEvent = saveEvent;
  window.updateTickets = updateTickets;
  window.resetTickets = resetTickets;
  window.deleteEvent = deleteEvent;

</script>

</body>
</html>
